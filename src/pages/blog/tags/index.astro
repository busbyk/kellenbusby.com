---
import { getCollection } from 'astro:content';
import Layout from '../../../layouts/Layout.astro';
import PageLayout from '../../../components/PageLayout.astro';

const allPosts = await getCollection('blog');
const posts = allPosts.filter((post) => post.data.published);

// Count published posts per tag
const tagCounts = posts.reduce(
  (acc, post) => {
    post.data.tags.forEach((tag) => {
      acc[tag] = (acc[tag] || 0) + 1;
    });
    return acc;
  },
  {} as Record<string, number>
);

const sortedTags = Object.entries(tagCounts).sort((a, b) => b[1] - a[1]);
---

<Layout title="Tags | Kellen Busby">
  <PageLayout heading="All Tags">
    <a href="/blog" class="text-primary hover:underline mb-6 inline-block">
      &larr; Back to blog
    </a>

    {sortedTags.length === 0 ? (
      <p class="text-muted">No tags yet.</p>
    ) : (
      <div class="flex flex-wrap gap-4">
        {sortedTags.map(([tag, count]) => (
          <a
            href={`/blog/tags/${tag}`}
            class="px-4 py-2 bg-card rounded-lg hover:bg-primary hover:text-primary-foreground transition-colors flex items-center gap-2"
          >
            <span>{tag}</span>
            <span class="text-xs bg-background px-2 py-0.5 rounded-full">
              {count}
            </span>
          </a>
        ))}
      </div>
    )}
  </PageLayout>
</Layout>
